<h1> 보안을 위한 네트워크 설계 </h1>

<br><br> 
내뷰의 사용자는 외부의 인터넷을 이용할 수 있지만 외부에서는 내부로 침입할 수 없게 하는 방법이 필요해졌다. <br> 
사설 IP라고 불리는 nonroutable IP 주소를 이용 <br> 
이 방법은 내부 컴퓨터 사이의 트래픽은 하용하면서 외부 인터넷과의 접속은 허용 또는 제한할 수 있는 쉽고 좋은 방법이다. <br> 
이 사설 IP의 주소 범위는 10.0.0.0 ~ 10.255.255.255 ,  172.16.0.0 ~ 172.31.255.255, 192.168.0.0 ~ 192.168.255.255의 3가지가 있다. <br> 
외부의 컴퓨터는 이 주소 범위에 있는 컴퓨터에 접근할 수 없게 된다. <br> 
하지만 이 주소의 컴퓨터 또한 외부 인터넷으로 나갈 수가 없다. 그래서 사설 IP 주소의 컴퓨터가 외부 인터넷에 접속할 수 있도록 해주는 IP 마스커레이딩(Masquerading)이라는 방법을 활용한다. <br> <br> <br> 
![image](https://user-images.githubusercontent.com/43237961/196317161-f1bec490-2cb1-4d59-b1a3-1b6cc2aebe22.png) <br> 

1. 사설 네트워크는 회사의 내부라고 생각하면 된다. 그림에는 2대 뿐이지만 실무에서는 더 많은 컴퓨터가 있을 것이다. 
2. 외부 네트워크는 특정 컴퓨터가 아닌 인터넷상의 모든 컴퓨터라고 생각하면 된다. 
3. 방화벽 컴퓨터에는 2개의 네트워크 카드가 설치되어 있어야 한다. 내부의 사설 네트워크에 연결될 네트워크 카드, 하나는 외부의 인터넷과 연결될 네트워크 카드다. 
4. 허브는 내부에 있는 여러 대의 컴퓨터와 방화벽을 연결하는 장치다. 내부의 컴퓨터가 1대 뿐이라면 허브는 없어도 될 것이다. 실무에서는 주로 성능이 좋고 고가인 스위칭 허브를 많이 사용한다. 

<h1> 작동원리 </h1> 
1. 사설 네트워크 안의 컴퓨터들은 외부의 인터넷에 접속할 수 있어야 한다. 사설 네트워크안에 있는 컴퓨터들의 네트워크 정보 중, 게이트웨이 주소는 방화벽 컴퓨터의 [사설 IP3]으로 지정되어 있어야 한다. 그래야만 게이트웨이를 통해 외부의 인터넷에 접속할 수 있다. <br><br> 
만약 리눅스 클라이언트가 방화벽 컴퓨터를 통해 외부 네트워크 [공인 IP2]의 WINDOWS 컴퓨터에 접속했다면, 외부의 WINDOWS 컴퓨터 입장에서는 리눅스 클라이언트의 [사설 IP1]이 접근했다는 사실을 알지 못하며, 단지 방화벽 컴퓨터의 [공인 IP 1]로 접속되었다는 사실만 알 수 있다. 결론적으로 사설 네트워크의 모든 컴퓨터가 외부 인터넷을 사용할 때는 방화벽의 공인 IP1을 사용하게 된다. 이러한 것을 마스커레이딩이라고 부른다. <br>  
<br>  

```java

IP Masquerade(또는 MASQ, IPMASQ)란 리눅스의 NAT(Network Address Translation) 기능으로써
내부 컴퓨터들이 리눅스 서버를 통해서 인터넷 등 다른 네트워크에 접속할 수 있도록 해주는 기능입니다.

내부 컴퓨터들이 생성한 모든 네트워크 요청은 MASQ를 통해서 리눅스 서버의 외부 공인IP로 변환되어 인터넷에 연결되기 때문에,
외부에서는 리눅스 서버의 IP만 알 수 있을 뿐, 내부 컴퓨터의 존재를 전혀 알 수 없습니다. 
이는 높은 보안성이라는 장점을 제공하지만, 반면에 외부에서 먼저 내부컴퓨터와 통신을 시도할 수 없기 때문에 상당한 제약으로 작용할 수 있습니다.

이러한 제약은 포워딩(iptable 이용)을 통해서 해소할 수 있습니다. 
즉, 외부에서 특정 포트나 프로토콜로 리눅스 서버에 요청할 경우 지정한 내부 컴퓨터로 연결하도록 규칙을 지정 수 있습니다.

```
<br> 
2. NAT의 기능을 알아보자. <br> 
   리눅스 클라이언트가 [사설 IP 1] 로 방화벽의 [서설 IP 3] 과 [공인 IP 1] 을 통해 외부 서버로 접속하려면 패킷을 전송하게 된다. <br> 
   그리고 이 외부 서버는 접속한 리눅스 클라이언트에게 응답 패킷을 전송해주려고 할 때, 리눅스 클라이언트의 IP 주소를 [사설 IP 1] 이 아닌 <br> 
   [공인 IP 1] 로 알고 있어서 [공인 IP 1]로 패킷을 전송한다. 그러면 방화벽 컴퓨터는 해당 패킷을 [사설 IP 1]로 전송하게 된다. <br> 
   이러한 것을 SNAT(Source NAT)이라고 부른다. <br> <br> 
3. 이번에는 외부에서 [사설 IP 2]를 이용하는 리눅스 웹 서버에 접속할 때를 생각해보자. <br> 
   일단은 방화벽의 [공인 IP 1]로 접속해야 하며 방화벽 컴퓨터가 이 패킷을 내부의 [사설 IP 2]에게 전송한다. <br> 
   이러한 기능을 DNAT(Destination NAT)이라고 부른다. <br> 
<br><br>
이러한 기능들은 자동으로 사용할 수 있는 것이 아니라, 서버 관리자가 직접 설정해야 한다. <br> 
서버 관리자가 여러 가지 규칙을 지정해주는 것을 '정책 수립'이라고 한다. <br> 
즉, 방화벽 컴퓨터는 서버 관리자에 따라 아주 강력한 보안 정책을 유지할 수도 있고, 유연한 보안 정책을 갖게될 수도 있고, 없는 것과 마찬가지일 수도 있다.
<br><br> 
실제로 아주 비싼 방화벽 장치를 설치한 곳에서도 내부와 외부의 모든 패킷을 허용하는 규칙을 설정해서 방화벽이 없는 것과 마찬가지로 운영하는 경우도 보았다. <br> 
이는 서버 관리자가 보안에 전혀 관심이 없거나, 또는 방화벽 개념이 전무하기 때문일 것이다. <br> 
결론적으로 방화벽 컴퓨터의 운영은 '정책'을 어떻게 수립하느냐의 문제가 더 중요하다고 할 수 있다. <br><br><br>

<h1> 리눅스 방화벽 컴퓨터 구축 </h1>
<br><br> 

![image](https://user-images.githubusercontent.com/43237961/196320795-502fbd98-1e31-4942-af33-50e6ee032ef1.png)  
<br><br><br>
1.  [그림 18-2]와 [그림 18-1]은 거의 같지만, 여기서 미리 이해하고 넘어가자. <br> 
    현재 우리는 VMware 내부에서 가상 컴퓨터를 사용하므로, 사설 IP 주소 범위를 192.168.111.ooo로 사용한다는 사실을 기억할 것이다. <br> 
    앞에서도 이야기했고 또 여러분이 잘 알듯이 이는 사설 IP 주소다. 그런데 이번 실습을 원활히 하려면 [그림 18-1]처럼 공인 IP 가 두 개 필요하다. <br> 
    그래서 이번 실습에서는 192.168.111.ooo와 그 외의 IP 주소는 공인 IP 주소로 취급하고 실습을 진행하겠다. <br>
    그리고 Client와 Server(B)가 포함된 사설 네트워크의 사설 IP 주소는 10.1.1.xxx 를 사용하겠다. [그림 18-1] 와 [그림 18-2]를 비교해서 보면 이해가 쉬울 것이다. <br> 
     이번 실습은 여러 대의 컴퓨터로 운영되는 실무 환경에서는 구현이 더 쉽다. 우리는 제약된 환경(VMware상)에서 실제 물리 환경과 동일한 구성을 실습하려는 것이므로 몇 가지 제약이 따르는 것 뿐이다. <br> <br>
2.  Client와 Server(B)는 기존처럼 네트워크 카드를 하나 설치해 사용한다. <br> 
    그런데 이번 실습에서는 VMware에서 가상머신의 네트워크로 지정했던 NAT(VMnet8)를 Bridged Network(VMnet0)로 변경해 사용한다. <br> 
    이렇게 하면 [그림 18-2] 왼쪽처럼 2대의 컴퓨터를 허브(가상)로 연결해 사설 네트워크상에 독립적으로 구성한 것 같은 효과를 낼 수 있다. <br> 
    그렇게 되면 호스트 운영체제를 비롯한 외부 컴퓨터가 사설 네트워크 안으로 접근할 수 없다. <br> <br> 
3.  Server에는 네트워크 카드를 2개 장착하겠다. 1개(ens34)는 사설 네트워크에 포함되도록 허브(가상)에 연결한다. <br> 
    그러려면 VMware의 네트워크를 Bridged Network(VMnet0)로 설정하고, IP 주소를 10.1.1.1로 사용하면 된다. <br> 
    이는 사설 네트워크의 컴퓨터들이 외부 인터넷으로 연결되는 데 필요한 게이트웨이 역할을 할 것이다. <br>  
    다른 1개(ens32)에는 외부와 연결되는 공인 IP(192.168.111.100)를 할당한다. 그러기 위해 VMware의 네트워크를 NAT(VMnet8)로 설정한다. <br>   <br> 
4.  호스트 운영체제(또는 WinClient)는 외부 인터넷상에 존재하는 컴퓨터로 사용된다.  <br>
    이는 순수한 사용자 컴퓨터가 될 수 있고, 악의적인 해커의 컴퓨터가 될 수도 있다. <br> <br>
5.  현재까지는 하드웨어와 운영체제만 구성해 놓았다. 이제는 '정책 수립'의 단계다.  <br>
    이번 실습에서는 다음과 같은 간단한 정책을 수립한다. 당연히 이 정책은 방화벽 컴퓨터인 Server에 적용할 내용이다. <br>
     * 내부 컴퓨터는 외부 인터넷을 사용할 수 있게 한다. <br>

     * 외부 컴퓨터는 기본적으로 내부에 접속할 수 없게 한다. <br>

     * 외부 컴퓨터가 방화벽 서버의 공인 IP(192.168.111.100)로 웹 서비스를 요청할 때는 내부에 있는 Server(B)(10.1.1.20)가 서비스할 수 있게 한다. <br>
     이 정도로 설명을 마치고 직접 실습해 보자. <br>
     <br> <br> <br>
